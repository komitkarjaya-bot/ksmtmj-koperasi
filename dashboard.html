<body>

<h2>Dashboard Anggota</h2>

<div id="loading">‚è≥ Memuat data anggota...</div>
<div id="error" style="display:none;color:red"></div>

<div id="data" style="display:none">
  <p>No Anggota: <span id="noanggota"></span></p>
  <p>Nama: <span id="nama"></span></p>
  <p>Email: <span id="email"></span></p>
  <p>Simpanan Pokok: <span id="pokok"></span></p>
  <p>Simpanan Wajib: <span id="wajib"></span></p>
  <p>Simpanan Sukarela: <span id="sukarela"></span></p>
</div>
 <script>
document.addEventListener("DOMContentLoaded", function () {

  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  if (!token) {
    showError("Token tidak ditemukan. Silakan login ulang.");
    return;
  }

  loadDashboardJSONP(token);
});

function loadDashboardJSONP(token) {

  const callbackName = "cb_" + Date.now();

  window[callbackName] = function (data) {

    delete window[callbackName];

    document.getElementById("loading").style.display = "none";

    if (!data || data.error) {
      showError(data?.error || "Data kosong dari server");
      return;
    }

    document.getElementById("data").style.display = "block";
    document.getElementById("noanggota").innerText = data.noanggota;
    document.getElementById("nama").innerText = data.nama;
    document.getElementById("email").innerText = data.email;
    document.getElementById("pokok").innerText = formatRupiah(data.pokok);
    document.getElementById("wajib").innerText = formatRupiah(data.wajib);
    document.getElementById("sukarela").innerText = formatRupiah(data.sukarela);
  };

  const script = document.createElement("script");
  script.src =
    "https://script.google.com/macros/s/AKfycbwr-KnyXlkMp5OqHaAolX14tL3uPvIuXwhQk8Fp-UiECEOE3oBJBu_XpC3YibGPZOKg/exec" +
    "?token=" + encodeURIComponent(token) +
    "&callback=" + callbackName;

  script.onerror = function () {
    showError("Gagal menghubungi server (JSONP).");
  };

  document.head.appendChild(script);
}

function showError(msg) {
  document.getElementById("loading").style.display = "none";
  const e = document.getElementById("error");
  e.style.display = "block";
  e.innerText = msg;
}

function formatRupiah(n) {
  return "Rp " + Number(n || 0).toLocaleString("id-ID");
}
</script>

</body>
</html>
