<body>

<h2>Dashboard Anggota</h2>

 <div id="loading">⏳ Memuat data anggota...</div>

 <div id="data" style="display:none">
  <p>No Anggota: <span id="noanggota"></span></p>
  <p>Nama: <span id="nama"></span></p>
  <p>Email: <span id="email"></span></p>
  <p>Simpanan Pokok: <span id="pokok"></span></p>
  <p>Simpanan Wajib: <span id="wajib"></span></p>
  <p>Simpanan Sukarela: <span id="sukarela"></span></p>
</div>
<script>
function isInAppBrowser() {
  const ua = navigator.userAgent || navigator.vendor;
  return /FBAN|FBAV|Instagram|Line|WhatsApp|Gmail/i.test(ua);
}

if (isInAppBrowser()) {
  document.body.innerHTML = `
    <h3>⚠️ Perhatian</h3>
    <p>Dashboard tidak bisa dibuka di aplikasi ini.</p>
    <button onclick="openInBrowser()">Buka di Browser</button>
  `;
}

function openInBrowser() {
  const url = window.location.href;
  window.open(url, "_blank");
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  if (!token) {
    showError("Token tidak ditemukan. Silakan login ulang.");
  } else {
    loadDashboardJSONP(token);
  }

  function loadDashboardJSONP(token) {

    const callbackName = "cb_" + Math.random().toString(36).substr(2, 9);

    window[callbackName] = function (data) {

      delete window[callbackName];
      const s = document.getElementById("jsonpScript");
      if (s) s.remove();

      document.getElementById("loading").style.display = "none";

      if (!data || data.error) {
        showError(data?.error || "Data kosong dari server");
        return;
      }

      document.getElementById("data").style.display = "block";
      document.getElementById("noanggota").innerText = data.noanggota;
      document.getElementById("nama").innerText = data.nama;
      document.getElementById("email").innerText = data.email;
      document.getElementById("pokok").innerText = formatRupiah(data.pokok);
      document.getElementById("wajib").innerText = formatRupiah(data.wajib);
      document.getElementById("sukarela").innerText = formatRupiah(data.sukarela);
    };

    const script = document.createElement("script");
    script.id = "jsonpScript";
    script.src =
    "https://script.google.com/macros/s/AKfycbwSPKnF3jzec1kS2bS0zGWB5CIQdHPy1C8NcfEIBzq9WN8U5YoH1CZLlLLGG4yzy1tQ/exec" +
    "?token=" + encodeURIComponent(token) +
    "&callback=" + callbackName +
    "&_ts=" + Date.now();


    script.onerror = function () {
      delete window[callbackName];
      showError("Gagal menghubungi server (JSONP).");
    };

    document.body.appendChild(script);
  }

  function showError(msg) {
    document.getElementById("loading").style.display = "none";
    const e = document.getElementById("error");
    e.style.display = "block";
    e.innerText = msg;
  }

  function formatRupiah(n) {
    return "Rp " + Number(n || 0).toLocaleString("id-ID");
  }


});
</script>

 
</body>
</html>
